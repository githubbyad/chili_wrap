<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Jost:wght@400;700&display=swap" rel="stylesheet">
    <title>TV - 1 - Form</title>
</head>

<body class="bg-secondary p-3">

    <div class="container bg-body rounded px-0 mb-5">

        <h1 class="bg-dark text-light py-3 text-center rounded">TV - 1</h1>

        <p class="lastChanges text-muted px-3">Last Modified: <span></span></p>

        <form class="p-3 mt-3">

            <!--general-->
            <div class="w-100 d-block rounded p-3 mb-4" style="background-color: #cacaca">
                <p class="fw-bold">General</p>
                <div class="mb-3 px-3">
                    <label class="form-label">Backgound Color:</label>
                    <input type="text" class="form-control" id="backgroundColor">
                    <div id="emailHelp" class="form-text">Change the color by placing Hex color code such as "#ff0000"
                    </div>
                </div>
            </div>

            <!--header-->
            <div class="w-100 d-block rounded p-3 mb-4" style="background-color: #cacaca">
                <p class="fw-bold">Header</p>
                <div class="mb-3 px-3">
                    <label class="form-label">Text:</label>
                    <input type="text" class="form-control" id="headerText">
                </div>
                <div class="mb-3 px-3">
                    <label class="form-label">Color:</label>
                    <input type="text" class="form-control" id="headerColor">
                </div>
                <div class="mb-3 px-3">
                    <label class="form-label">Font Size:</label>
                    <input type="text" class="form-control" id="headerFontSize">
                </div>
                <div class="mb-3 px-3">
                    <label class="form-label">Price:</label>
                    <input type="text" class="form-control" id="headerPrice">
                </div>
                <div class="mb-3 px-3">
                    <label class="form-label">Dots:</label>
                    <input type="text" class="form-control" id="headerDots">
                </div>
            </div>

            <!--all-wraps-->
            <div class="w-100 d-block rounded p-3 mb-4" style="background-color: #cacaca">
                <p class="fw-bold">All Wraps</p>
                <div class="mb-3 px-3">
                    <label class="form-label">List:</label>
                    <textarea class="form-control" id="allWrapList" style="height: 100px"></textarea>
                </div>
                <div class="mb-3 px-3">
                    <label class="form-label">Color:</label>
                    <input type="text" class="form-control" id="allWrapColor">
                </div>
                <div class="mb-3 px-3">
                    <label class="form-label">Font Size:</label>
                    <input type="text" class="form-control" id="allWrapFontSize">
                </div>
                <div class="mb-3 px-3">
                    <label class="form-label">Line Gap:</label>
                    <input type="text" class="form-control" id="allWrapGap">
                </div>
            </div>

            <!--all-souces-->
            <div class="w-100 d-block rounded p-3 mb-4" style="background-color: #cacaca">
                <p class="fw-bold">All Souces</p>
                <div class="mb-3 px-3">
                    <label class="form-label">List:</label>
                    <textarea class="form-control" id="allSouceList" style="height: 100px"></textarea>
                </div>
                <div class="mb-3 px-3">
                    <label class="form-label">Color:</label>
                    <input type="text" class="form-control" id="allSouceColor">
                </div>
                <div class="mb-3 px-3">
                    <label class="form-label">Font Size:</label>
                    <input type="text" class="form-control" id="allSouceFontSize">
                </div>
                <div class="mb-3 px-3">
                    <label class="form-label">Line Gap:</label>
                    <input type="text" class="form-control" id="allSouceGap">
                </div>
            </div>

            <!--arrow-->
            <div class="w-100 d-block rounded p-3 mb-4" style="background-color: #cacaca">
                <p class="fw-bold">Arrow</p>
                <div class="mb-3 px-3">
                    <label class="form-label">Text:</label>
                    <input type="text" class="form-control" id="selectSouceText">
                </div>
                <div class="mb-3 px-3">
                    <label class="form-label">Color:</label>
                    <input type="text" class="form-control" id="selectSouceColor">
                </div>
                <div class="mb-3 px-3">
                    <label class="form-label">Font Size:</label>
                    <input type="text" class="form-control" id="selectSouceFontSize">
                </div>
                <div class="mb-3 px-3">
                    <label class="form-label">Line Gap:</label>
                    <input type="text" class="form-control" id="selectSouceGap">
                </div>
            </div>

            <input type="hidden" id="lastModified">

            <center class="mb-3"><button type="submit" class="btn btn-primary px-4 me-3">Submit</button> <span
                    onclick="history.back()" class="btn btn-danger px-4">Cancel</span></center>

        </form>
    </div>

    <script>

        const url = `wrapsdata.json?v=${Math.random()}`;
        let lastModified = 0;

        const getData = async () => {
            const obj = await fetch(url);
            const data = await obj.json();
            lastModified = data.lastModified;

            // last modifed
            document.querySelector(".lastChanges span").innerText = data.lastModified;
            document.querySelector("#lastModified").value = new Date().toLocaleString();

            // fields
            document.querySelector("#backgroundColor").value = data.tv1.backgroundColor;

            // header
            document.querySelector("#headerText").value = data.tv1.header.text;
            document.querySelector("#headerColor").value = data.tv1.header.color;
            document.querySelector("#headerFontSize").value = data.tv1.header.fontSize;
            document.querySelector("#headerPrice").value = data.tv1.header.price;
            document.querySelector("#headerDots").value = data.tv1.header.dots;

            // all-wraps
            const wrapsList = () => {
                let list = "";
                data.tv1.allWraps.list.forEach(w => list += `${w}\n`);
                return list;
            }
            document.querySelector("#allWrapList").value = wrapsList();
            document.querySelector("#allWrapList").style.height = `${document.querySelector("#allWrapList").scrollHeight}px`;
            document.querySelector("#allWrapColor").value = data.tv1.allWraps.color;
            document.querySelector("#allWrapFontSize").value = data.tv1.allWraps.fontSize;
            document.querySelector("#allWrapGap").value = data.tv1.allWraps.gap;

            // all-souces
            const souceList = () => {
                let list = "";
                data.tv1.allSouces.list.forEach(s => list += `${s}\n`);
                return list;
            }
            document.querySelector("#allSouceList").value = souceList();
            document.querySelector("#allSouceList").style.height = `${document.querySelector("#allSouceList").scrollHeight}px`;
            document.querySelector("#allSouceColor").value = data.tv1.allSouces.color;
            document.querySelector("#allSouceFontSize").value = data.tv1.allSouces.fontSize;
            document.querySelector("#allSouceGap").value = data.tv1.allSouces.gap;

            // arrow
            document.querySelector("#selectSouceText").value = data.tv1.selectSouce.text;
            document.querySelector("#selectSouceColor").value = data.tv1.selectSouce.color;
            document.querySelector("#selectSouceFontSize").value = data.tv1.selectSouce.fontSize;
            document.querySelector("#selectSouceGap").value = data.tv1.selectSouce.gap;

            // form submit
            document.forms[0].addEventListener("submit", (e) => {
                e.preventDefault();
                data.lastModified = document.querySelector("#lastModified").value.trim();

                data.tv1.header.text = document.querySelector("#headerText").value.trim();
                data.tv1.header.color = document.querySelector("#headerColor").value.trim();
                data.tv1.header.fontSize = document.querySelector("#headerFontSize").value.trim();
                data.tv1.header.price = document.querySelector("#headerPrice").value.trim();
                data.tv1.header.dots = document.querySelector("#headerDots").value.trim();

                data.tv1.allWraps.list = document.querySelector("#allWrapList").value.split("\n").filter(l => l.trim() != "");
                data.tv1.allWraps.color = document.querySelector("#allWrapColor").value.trim();
                data.tv1.allWraps.fontSize = document.querySelector("#allWrapFontSize").value.trim();
                data.tv1.allWraps.gap = document.querySelector("#allWrapGap").value.trim();

                data.tv1.allSouces.list = document.querySelector("#allSouceList").value.split("\n").filter(l => l.trim() != "");
                data.tv1.allSouces.color = document.querySelector("#allSouceColor").value.trim();
                data.tv1.allSouces.fontSize = document.querySelector("#allSouceFontSize").value.trim();
                data.tv1.allSouces.gap = document.querySelector("#allSouceGap").value.trim();

                data.tv1.selectSouce.text = document.querySelector("#selectSouceText").value.trim();
                data.tv1.selectSouce.color = document.querySelector("#selectSouceColor").value.trim();
                data.tv1.selectSouce.fontSize = document.querySelector("#selectSouceFontSize").value.trim();
                data.tv1.selectSouce.gap = document.querySelector("#selectSouceGap").value.trim();

                // upload data to json file
                async function uploadData(url) {
                    const response = await fetch(url, {
                        method: "POST",
                        mode: "cors",
                        cache: "no-cache",
                        credentials: "same-origin",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        redirect: "follow",
                        referrerPolicy: "no-referrer",
                        body: JSON.stringify(data),
                    });
                    if (response.ok) {
                        alert('Success! Data has been submitted.');
                        location.href = "list.htm";
                    }
                }

                uploadData("wrapupload.php");
            });


        };
        getData();

    </script>
    <style>
    </style>
</body>

</html>